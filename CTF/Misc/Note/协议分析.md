# 流量协议分析

## 各类协议简介和数据包

网络协议

网络协议为计算机网络中进行数据交换而建立的规则，标准或约定的集合。

例如，网络中一个微机用户和一个大型主机的操作员进行通信，由于这两个数据终端所用字符集不同，因此操作员所输入的命令彼此不认识。为了能进行通信，规定每个终端都要将各自字符集中的字符先变换为标准字符集的字符后，才进入网络传送，到达目的终端之后，再变换为该终端字符集的字符。当然，对于不相容终端，除了需变换字符集字符外还需转换其他特性，如显示格式、行长、行数、屏幕滚动方式等也需作相应的变换。

HTTP（HyperText Transfer Protocol：超文本传输协议）是一种用于分布式、协作式和超媒体信息系统的应用层协议。 简单来说就是一种发布和接收 HTML 页面的方法，被用于在 Web 浏览器和网站服务器之间传递信息。

HTTP 默认工作在 TCP 协议 80 端口，用户访问网站 http:// 打头的都是标准 HTTP 服务。

HTTP 协议以明文方式发送内容，不提供任何方式的数据加密，如果攻击者截取了Web浏览器和网站服务器之间的传输报文，就可以直接读懂其中的信息，因此，HTTP协议不适合传输一些敏感信息，比如：信用卡号、密码等支付信息。

HTTPS 协议

HTTPS（Hypertext Transfer Protocol Secure：超文本传输安全协议）是一种透过计算机网络进行安全通信的传输协议。HTTPS 经由 HTTP 进行通信，但利用 SSL/TLS 来加密数据包。HTTPS 开发的主要目的，是提供对网站服务器的身份认证，保护交换数据的隐私与完整性。

HTTPS 默认工作在 TCP 协议443端口

Telnet 协议

Telnet 协议是TCP/IP中的一种应用协议 可以为终端仿真提供支持. 可使用户连接到主机上，使主机响应起来就像它直接连接在终端上一样。Telnet 在发送端和接收端使用 TCP 的23端口进行专用的通信.

> 明文传输

FTP 协议
FTP 协议使用 TCP 20号和21号端口，20号端口用于数据交换，21号端口用于建立连接，允许目录和文件访问。上传下载，不能远程执行文件。
TFTP 是简单文件传输协议 (Trivial File Transfer Protocol,TFTP) TFTP 是无连接的，使用 UDP 的69号端口，用于当数据传输错误无关紧要而且必须安全性时的小型文件的传输。

蓝牙传输协议 (obex)

由无线数据协议创建，并不是蓝牙本身协议，通过 OBEX 协议可以创建出能够在任何传输机制 (例如，红外，TCP/IP) 上运行的应用程序。蓝牙协议栈中的 OBEX 层实际是面向蓝牙设备间的文件传输而优化的，所以可以向传统的 FTP 一样使用，OBEX 应用程序拥有像 GET 和 PUT 这样的操作。

无线握手包

WIFI 连接认证的重点在于 WPA 的四次握手，也就是 eapol 协议的包， EAPOL 的全称为 (Extensible Authentication Protocol Over LAN) 即 EAP Over Lan 也即基于局域网的扩展认证协议。 EAP 是一个普通使用的认证机制，它常被用于无线网络或点到点的连接中。EAP 不仅可以用于无线局域网，而且可以用于有线局域网。EAP 是一个认证架构，而不是一个特殊的认证机制。EAP 提供一些公共的功能，并且允许协商所希望的认证机制。


ICMP 协议
IP 协议是一种面向无连接的数据报协议，他是一种不可靠的协议，它不提供任何差错检验。因此国际报文控制协议 (Internet Control Message Protocol) ICMP 出现了，ICMP 协议用于 IP主机，路由器之间传递控制信息，这里的控制信息可以包括很多种:数据报文错误信息，网络状况信息，主机状况信息，虽然这些控制信息并不传输用户数据，但对于用户数据报的有效传递起着重要作用，从 TCP/IP 的分层结构来看 ICMP 属于网络层，它配合着 IP 数据报的提交，提高IP数据报递交的可靠性。

## 考察方式

### 提取图片，压缩包等信息

比如一个流量包里发现了 zip 或者 png 的文件头部，怎么把文件提取出来?


解决方法：
+ 使用 Wireshark 的导出对象功能
+ 使用 Wireshark 追踪关键流并保存为原始数据。
+ 利用 010editor 等 16 进制编辑器根据文件头尾修复文件
 


### HTTPS 数据包 SSL 解密

SSL (Secure Socket Layer) 安全套接字层协议；TLS(Transport Layer Security) 传输层安全协议。SSL/TLS 是保护计算机网络通讯安全的一类加密协议，它们在传输层上给原先非安全的应用层协议提供加密保护，如非安全的 HTTP 协议即可被 SSL/TLS 保护形成安全的 HTTPS 协议。

解决方法：
+ 在Wireshark 中通过 编辑 - 首选项 - 协议 (Protocol) - SSL -(Pre)-Master-Secret log filename 指定SSLKEYLOGFILE 文件，即可解密流量(流量包) 中的 HTTPS 流量

### 手机蓝牙数据包提取文件

OBEX 为 Object Exchange 用于在蓝牙设备剑传输数据对象，来源于红外定义的协议，后被蓝牙采用，题目提示手机之间传输文件，可能是蓝牙传输，可以考虑查看 OBEX 协议内容


解决方法：
蓝牙传输协议为 OBEX 使用 wireshark 过滤
可以使用 foremost 等工具辅助提取

### WIFI 握手包破解密码

利用 wireshark 可以打开wifi连接时的握手包，利用题目信息生成字典或使用kali下的字典，爆破握手包密码。

+ 解决方法
利用 aircrack-ng 进行爆破
aircrack-ng -w wifipass.txt wifi.cap


### ICMP 包隐藏信息

ICMP 也可以携带少量信息，可以通过观察data段来快速发现

解决方法：使用wireshark 查找icmp 包的data数据段
