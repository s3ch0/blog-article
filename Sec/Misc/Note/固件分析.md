
# 固件分析

[](https://github.com/rampageX/firmware-mod-kit)
随着物联网安全的发展，路由器，工控，打印机，门禁等的安全问题越来越被大家重视，CTF 中也引入了这类型题目。以路由器举例，目前大部分路由器都采用了 Linux 系统，这为漏洞的挖掘提供了不少便利，毕竟各种 Linux 工具都是上手就能用，路由器的文件系统一般都为： SquashFS 要对路由器进行漏洞分析，首先需要拿到路由器的固件一般来说拿到固件有两种方式：
方式一： 直接去官方网站下载官方提供的固件，其中直接打包了路由器的文件系统
方法二： 通过拆解路由器，通过串口将整个系统镜像下来。


提取固件

Binwalk 在 CTF 的杂项题目常用，在日常的安全研究中常用于固件的逆向，提取等。

我们都知道 binwalk 可以对指定文件进行扫描，然后打印出可能在其中的一些特定类型的文件，比如打 ctf 的隐写类题目时有时候binwalk 一下就搞定了。

是否加密

在进行固件分析是，你可能会碰到某种程度上是加密的文件。在这种情况下，你首先需要确认是否是整个文件都加密了还是只有其中一块。如果是加密的，你可能还需要检查一下其详细信息

如果只是通过滚动鼠标一行一行地检查，肯定会很费劲。而从一个更高层的角度来审视整个文件，会好很多

计算熵是一种感知给定字节序列是否压缩或加密的有效手段。熵值大，意味着有可能是加密的或压缩过的。熵值第，则正好相反。不过即使得到具体的熵值，也并不是总能立刻得到准确的判断。


分析二进制程序
交互式反汇编器专业版 (Interactive Disassembler Professional) 人们常称其为 IDA Pro 或简称 IDA.是目前最棒的一个静态反编译软件，我们使用 ida 分析固件中的程序文件，事半功倍，如果想搭建固件进行动态调试，可以考虑使用 qemu 模拟硬件环境


## 提取固件

假如题目是路由器的，在 squashfs-root 目录下：
web 服务器的二进制程序 (通常在 /bin/httpd 或者 /bin/web)

各种功能的 cgi 文件 (/home/ 或者 /tmp 或者 /var)

web 源码, html/js (好像没啥用)

有的路由器会安装 lua 这种直接可以去找 web 源码，接下来只要审计 php 那样去审计就可以完成web层面的漏洞分析了。

解决方法:
+ 使用 binwalk 提取固件
+ 根据目标架构分析

逆向分析

有些题目需要选手具备基本IDA和其它逆向工具的使用方法

解决方法
使用 IDA 或者其它逆向工具，对 misp 或者 arm 架构的固件进行分析
